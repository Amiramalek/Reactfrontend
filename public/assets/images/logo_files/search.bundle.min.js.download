this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,r,i,l){"use strict";const o="im-recent-v2";const c="IM_CHAT_SEARCH";const n="im-chat-search";const d=e=>{const s={id:o,dynamicLoad:true,dynamicSearch:true,options:b(e)};return{dialog:{entities:[s],preselectedItems:[],clearUnavailableItems:false,context:c,id:n}}};const b=e=>{const t={withChatByUsers:false};if(!e){return{...t,exclude:[]}}const a=[];if(s.Type.isBoolean(e.chats)&&!e.chats){a.push("chats")}if(s.Type.isBoolean(e.users)&&!e.users){a.push("users")}return{...t,exclude:a}};var u=babelHelpers.classPrivateFieldLooseKey("store");var h=babelHelpers.classPrivateFieldLooseKey("userManager");var v=babelHelpers.classPrivateFieldLooseKey("prepareDataForModels");class p{constructor(){Object.defineProperty(this,v,{value:g});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,u)[u]=r.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new t.UserManager}update(e){const{users:s,chats:t}=babelHelpers.classPrivateFieldLooseBase(this,v)[v](e);return Promise.all([babelHelpers.classPrivateFieldLooseBase(this,h)[h].setUsersToModel(s),babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("chats/set",t)])}}function g(e){const s={users:[],chats:[]};e.forEach((e=>{const a=e.customData.chat;if(e.entityType===i.SearchEntityIdTypes.imUser){s.users.push(e.customData.user)}if(e.entityType===i.SearchEntityIdTypes.chat){const r=Boolean(e.customData.user);const i=r?t.UserManager.getDialogForUser(e.customData.user):{};s.chats.push({...a,...i,dialogId:e.id})}}));return s}const P=new Intl.Collator(undefined,{sensitivity:"base"});var f=babelHelpers.classPrivateFieldLooseKey("searchConfig");var y=babelHelpers.classPrivateFieldLooseKey("store");var L=babelHelpers.classPrivateFieldLooseKey("search");var F=babelHelpers.classPrivateFieldLooseKey("getRecentListItems");var B=babelHelpers.classPrivateFieldLooseKey("prepareRecentItem");var H=babelHelpers.classPrivateFieldLooseKey("searchByQueryWords");var m=babelHelpers.classPrivateFieldLooseKey("searchByDialogFields");var I=babelHelpers.classPrivateFieldLooseKey("searchByUserFields");var M=babelHelpers.classPrivateFieldLooseKey("doesItemMatchQuery");var O=babelHelpers.classPrivateFieldLooseKey("getLocalItems");var j=babelHelpers.classPrivateFieldLooseKey("getLocalItemsFromDialogIds");var K=babelHelpers.classPrivateFieldLooseKey("mergeItems");var S=babelHelpers.classPrivateFieldLooseKey("filterByConfig");var C=babelHelpers.classPrivateFieldLooseKey("getRecentItemDate");class w{constructor(e){Object.defineProperty(this,C,{value:V});Object.defineProperty(this,S,{value:Q});Object.defineProperty(this,K,{value:k});Object.defineProperty(this,j,{value:A});Object.defineProperty(this,O,{value:R});Object.defineProperty(this,M,{value:W});Object.defineProperty(this,I,{value:E});Object.defineProperty(this,m,{value:x});Object.defineProperty(this,H,{value:T});Object.defineProperty(this,B,{value:D});Object.defineProperty(this,F,{value:U});Object.defineProperty(this,L,{value:X});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=r.Core.getStore()}search(e,s){const t=babelHelpers.classPrivateFieldLooseBase(this,O)[O](s);const a=babelHelpers.classPrivateFieldLooseBase(this,L)[L](e,t);return babelHelpers.classPrivateFieldLooseBase(this,S)[S](a)}}function X(e,s){const t=l.Utils.text.getWordsFromString(e);const a=new Map;s.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,H)[H](e,t)){a.set(e.dialogId,{dialogId:e.dialogId,dateMessage:e.dateMessage})}}));return[...a.values()]}function U(){return babelHelpers.classPrivateFieldLooseBase(this,y)[y].getters["recent/getSortedCollection"].map((e=>{const s=babelHelpers.classPrivateFieldLooseBase(this,C)[C](e);return babelHelpers.classPrivateFieldLooseBase(this,B)[B](e.dialogId,s)}))}function D(e,s){const t=babelHelpers.classPrivateFieldLooseBase(this,y)[y].getters["chats/get"](e,true);const a=t.type===i.ChatType.user;const r={dialogId:e,dialog:t,dateMessage:s};if(a){r.user=babelHelpers.classPrivateFieldLooseBase(this,y)[y].getters["users/get"](e,true)}return r}function T(e,s){if(e.user){return babelHelpers.classPrivateFieldLooseBase(this,I)[I](e,s)}return babelHelpers.classPrivateFieldLooseBase(this,m)[m](e,s)}function x(e,s){const t=[];if(e.dialog.name){const s=l.Utils.text.getWordsFromString(e.dialog.name.toLowerCase());t.push(...s)}return babelHelpers.classPrivateFieldLooseBase(this,M)[M](t,s)}function E(e,s){const t=[];if(e.user.name){const s=l.Utils.text.getWordsFromString(e.user.name.toLowerCase());t.push(...s)}if(e.user.workPosition){const s=l.Utils.text.getWordsFromString(e.user.workPosition.toLowerCase());t.push(...s)}return babelHelpers.classPrivateFieldLooseBase(this,M)[M](t,s)}function W(e,s){let t=0;s.forEach((s=>{let a=0;e.forEach((e=>{const t=e.slice(0,s.length);if(P.compare(s,t)===0){a++}}));if(a>0){t++}}));return t>=s.length}function R(e){const s=babelHelpers.classPrivateFieldLooseBase(this,F)[F]();const t=babelHelpers.classPrivateFieldLooseBase(this,j)[j](e);return babelHelpers.classPrivateFieldLooseBase(this,K)[K](t,s)}function A(e){return e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,B)[B](e.dialogId,e.dateMessage)))}function k(e,s){const t=new Map;const a=[...e,...s];for(const e of a){if(!t.has(e.dialogId)){t.set(e.dialogId,e)}}return[...t.values()]}function Q(e){if(!babelHelpers.classPrivateFieldLooseBase(this,f)[f]){return e}return e.filter((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,f)[f].chats&&e.dialogId.startsWith("chat")){return true}return!e.dialogId.startsWith("chat")&&babelHelpers.classPrivateFieldLooseBase(this,f)[f].users}))}function V(e){var s;const t=(s=babelHelpers.classPrivateFieldLooseBase(this,y)[y].getters["recent/getMessage"](e.dialogId))==null?void 0:s.date;if(!t){return""}return t.toISOString()}e.getSearchConfig=d;e.EntityId=o;e.StoreUpdater=p;e.LocalSearch=w})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Messenger.v2.Lib,BX.Vue3.Vuex,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib);
//# sourceMappingURL=search.bundle.map.js