this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,o,r,n,a,l,c,p){"use strict";const d="icon.png";const b="internal.png";const v="http://127.0.0.1:20141";const h=500;const u="bx-im-messenger__out-of-view";const k="//www.bitrixsoft.com/200.ok";const g={};const L={testImageLoad(e=d){let t=null;const s=new Promise((e=>{t=e}));const i=Date.now();let o=false;const r=n.Dom.create({tag:"img",attrs:{src:`${v}/${e}?${i}`,"data-id":i},props:{className:u},events:{error(){if(o){return}const e=this.dataset.id;t(false);clearTimeout(g[e]);n.Dom.remove(this)},load(){const e=this.dataset.id;t(true);clearTimeout(g[e]);n.Dom.remove(this)}}});document.body.append(r);g[i]=setTimeout((()=>{o=true;t(false);n.Dom.remove(r)}),h);return s},testInternetConnection(){const e=Date.now();return new Promise((t=>{fetch(`${k}.${e}`).then((e=>{if(e.status===200){t(true);return}t(false)})).catch((()=>{t(false)}))}))},IMAGE_DESKTOP_RUN:d,IMAGE_DESKTOP_TWO_WINDOW_MODE:b};let f=[];let P=0;const B={openConference(e){if(!a.Utils.conference.isValidCode(e)){return false}if(!c.DesktopApi.isDesktop()){return false}let t=null;const s=[{width:2560,height:1440},{width:2048,height:1152},{width:1920,height:1080},{width:1600,height:900},{width:1366,height:768},{width:1024,height:576}];for(const e of s){t=e;if(screen.width>e.width&&screen.height>e.height){break}}f=f.filter((e=>Boolean(c.DesktopApi.findWindow(e))));f.push(a.Utils.conference.getWindowNameByCode(e));c.DesktopApi.createWindow(a.Utils.conference.getWindowNameByCode(e),(s=>{s.SetProperty("title",n.Loc.getMessage("IM_LIB_DESKTOP_CONFERENCE_TITLE"));s.SetProperty("clientSize",{Width:t.width,Height:t.height});s.ExecuteCommand("center");s.SetProperty("minClientSize",{Width:940,Height:400});s.SetProperty("backgroundColor","#2B3038");s.ExecuteCommand("html.load",`<script>location.href="/desktop_app/router.php?alias=${e}&videoconf";<\/script>`);s.ExecuteCommand("show");s.ExecuteCommand("center")}));return true},toggleConference(){if(P>f.length-1){P=0;c.DesktopApi.showWindow();return true}f=f.filter((e=>Boolean(c.DesktopApi.findWindow(e))));for(let e=P;e<f.length;e++){P++;const t=c.DesktopApi.findWindow(f[e]);if(t){c.DesktopApi.activateWindow(t);break}}return true}};const D=60*60*1e3;var y=babelHelpers.classPrivateFieldLooseKey("initDate");var C=babelHelpers.classPrivateFieldLooseKey("sidePanelManager");var F=babelHelpers.classPrivateFieldLooseKey("startReloadCheck");var m=babelHelpers.classPrivateFieldLooseKey("isReloadNeeded");var H=babelHelpers.classPrivateFieldLooseKey("reloadWindow");class w{static init(){return new w}constructor(){Object.defineProperty(this,H,{value:E});Object.defineProperty(this,m,{value:T});Object.defineProperty(this,F,{value:x});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:BX.SidePanel.Instance});babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new Date;babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}}function x(){setInterval((async()=>{const e=await babelHelpers.classPrivateFieldLooseBase(this,m)[m]();if(e){babelHelpers.classPrivateFieldLooseBase(this,H)[H]()}}),D)}async function T(){if(a.Utils.date.isSameDay(new Date,babelHelpers.classPrivateFieldLooseBase(this,y)[y])){return false}if(babelHelpers.classPrivateFieldLooseBase(this,C)[C].opened){p.Logger.desktop("Checker: checkDayForReload, slider is open - delay reload");return false}if(i.CallManager.getInstance().hasCurrentCall()){p.Logger.desktop("Checker: checkDayForReload, call is active - delay reload");return false}return L.testInternetConnection()}function E(){p.Logger.desktop("Checker: checkDayForReload, new day - reload window");c.DesktopApi.reloadWindow()}const O="!!";const A={encodeParams(e){if(!n.Type.isPlainObject(e)){return""}let t="";Object.entries(e).forEach((([e,s])=>{const i="";t+=`${i}${e}${O}${s}`}));return t},decodeParams(e){const t={};if(!n.Type.isStringFilled(e)){return t}const s=e.split(O);for(let e=0;e<s.length;e+=2){const i=s[e];const o=s[e+1];t[i]=o}return t},encodeParamsJson(e){if(!n.Type.isPlainObject(e)){return"{}"}let t="";try{t=encodeURIComponent(JSON.stringify(e))}catch(e){console.error("DesktopUtils: could not encode params.",e);t="{}"}return t},decodeParamsJson(e){let t={};if(!n.Type.isStringFilled(e)){return t}try{t=JSON.parse(decodeURIComponent(e))}catch(e){console.error("DesktopUtils: could not decode encoded params.",e)}return t}};var I=babelHelpers.classPrivateFieldLooseKey("subscribeToBxProtocolEvent");var S=babelHelpers.classPrivateFieldLooseKey("subscribeToLegacyBxProtocolEvent");class M{static init(){return new M}constructor(){Object.defineProperty(this,S,{value:j});Object.defineProperty(this,I,{value:$});babelHelpers.classPrivateFieldLooseBase(this,I)[I]();babelHelpers.classPrivateFieldLooseBase(this,S)[S]()}}function $(){c.DesktopApi.subscribe(l.EventType.desktop.onBxLink,((e,s)=>{const i=s!=null?s:{};Object.entries(i).forEach((([e,t])=>{i[e]=decodeURIComponent(t)}));if(e!==l.DesktopBxLink.openPage){c.DesktopApi.activateWindow()}if(e===l.DesktopBxLink.chat){var o;const e=(o=i.messageId)!=null?o:0;void t.Messenger.openChat(i.dialogId,e)}else if(e===l.DesktopBxLink.lines){void t.Messenger.openLines(i.dialogId)}else if(e===l.DesktopBxLink.conference){void Ze.getInstance().openConference(i.code)}else if(e===l.DesktopBxLink.call){const e=i.withVideo!=="N";void t.Messenger.startVideoCall(i.dialogId,e)}else if(e===l.DesktopBxLink.phone){const e=A.decodeParamsJson(i.phoneParams);void t.Messenger.startPhoneCall(i.number,e)}else if(e===l.DesktopBxLink.callList){const e=A.decodeParamsJson(i.callListParams);void t.Messenger.startCallList(i.callListId,e)}else if(e===l.DesktopBxLink.notifications){void t.Messenger.openNotifications()}else if(e===l.DesktopBxLink.recentSearch){void t.Messenger.openRecentSearch()}else if(e===l.DesktopBxLink.copilot){void t.Messenger.openCopilot(i.dialogId)}else if(e===l.DesktopBxLink.collab){void t.Messenger.openCollab(i.dialogId)}else if(e===l.DesktopBxLink.settings){void t.Messenger.openSettings({onlyPanel:i.section})}else if(e===l.DesktopBxLink.chatCreation){void t.Messenger.openChatCreation(i.chatType)}else if(e===l.DesktopBxLink.timeManager){var r,n;(r=BX.Timeman)==null?void 0:(n=r.Monitor)==null?void 0:n.openReport()}else if(e===l.DesktopBxLink.openTab){c.DesktopApi.setActiveTab()}else if(e===l.DesktopBxLink.openPage){const e=A.decodeParamsJson(i.options);c.DesktopApi.openPage(e.url,e.options)}else if(e===l.DesktopBxLink.botContext){const{dialogId:e,context:s}=i;const o=A.decodeParamsJson(s);void t.Messenger.openChatWithBotContext(e,o)}}))}function j(){c.DesktopApi.subscribe(l.EventType.desktop.onBxLink,((e,s)=>{const i=s!=null?s:{};Object.entries(i).forEach((([e,t])=>{i[e]=decodeURIComponent(t)}));c.DesktopApi.activateWindow();if(e===l.LegacyDesktopBxLink.messenger){if(i.dialog){void t.Messenger.openChat(i.dialog)}else if(i.chat){void t.Messenger.openChat(`chat${i.chat}`)}else{void t.Messenger.openChat()}}else if(e===l.LegacyDesktopBxLink.chat&&i.id){void t.Messenger.openChat(`chat${i.id}`)}else if(e===l.LegacyDesktopBxLink.notify){void t.Messenger.openNotifications()}else if(e===l.LegacyDesktopBxLink.callTo){if(i.video){void t.Messenger.startVideoCall(i.video)}else if(i.audio){void t.Messenger.startVideoCall(i.audio,false)}else if(i.phone){void t.Messenger.startPhoneCall(i.phone)}}else if(e===l.LegacyDesktopBxLink.callList){void t.Messenger.openRecentSearch()}}))}var K=babelHelpers.classPrivateFieldLooseKey("subscribeToLogoutEvent");var W=babelHelpers.classPrivateFieldLooseKey("onExit");class U{static init(){return new U}constructor(){Object.defineProperty(this,W,{value:N});Object.defineProperty(this,K,{value:R});babelHelpers.classPrivateFieldLooseBase(this,K)[K]()}}function R(){c.DesktopApi.subscribe(l.EventType.desktop.onExit,babelHelpers.classPrivateFieldLooseBase(this,W)[W].bind(this))}function N(){s.runAction(l.RestMethod.imV2DesktopLogout).finally((()=>{c.DesktopApi.shutdown()}))}var X=babelHelpers.classPrivateFieldLooseKey("initDate");var _=babelHelpers.classPrivateFieldLooseKey("wakeUpTimer");var V=babelHelpers.classPrivateFieldLooseKey("subscribeToWakeUpEvent");var J=babelHelpers.classPrivateFieldLooseKey("onWakeUp");var G=babelHelpers.classPrivateFieldLooseKey("subscribeToIconClickEvent");var z=babelHelpers.classPrivateFieldLooseKey("onIconClick");var q=babelHelpers.classPrivateFieldLooseKey("subscribeToAwayEvent");var Y=babelHelpers.classPrivateFieldLooseKey("onUserAway");var Q=babelHelpers.classPrivateFieldLooseKey("subscribeToFocusEvent");var Z=babelHelpers.classPrivateFieldLooseKey("subscribeToBlurEvent");var ee=babelHelpers.classPrivateFieldLooseKey("removeNativeNotifications");var te=babelHelpers.classPrivateFieldLooseKey("setInitialStatus");var se=babelHelpers.classPrivateFieldLooseKey("subscribeToStatusChange");class ie{static init(){return new ie}constructor(){Object.defineProperty(this,se,{value:he});Object.defineProperty(this,te,{value:ve});Object.defineProperty(this,ee,{value:be});Object.defineProperty(this,Z,{value:de});Object.defineProperty(this,Q,{value:pe});Object.defineProperty(this,Y,{value:ce});Object.defineProperty(this,q,{value:le});Object.defineProperty(this,z,{value:ae});Object.defineProperty(this,G,{value:ne});Object.defineProperty(this,J,{value:re});Object.defineProperty(this,V,{value:oe});Object.defineProperty(this,X,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:null});this.sidePanelManager=BX.SidePanel.Instance;babelHelpers.classPrivateFieldLooseBase(this,X)[X]=new Date;babelHelpers.classPrivateFieldLooseBase(this,V)[V]();babelHelpers.classPrivateFieldLooseBase(this,q)[q]();babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]();babelHelpers.classPrivateFieldLooseBase(this,G)[G]();babelHelpers.classPrivateFieldLooseBase(this,te)[te]();babelHelpers.classPrivateFieldLooseBase(this,se)[se]()}}function oe(){c.DesktopApi.subscribe(l.EventType.desktop.onWakeUp,babelHelpers.classPrivateFieldLooseBase(this,J)[J].bind(this))}async function re(){const e=await L.testInternetConnection();if(!e){p.Logger.desktop("StatusHandler: onWakeUp event, no internet connection, delay 60 sec");clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,_)[_]);babelHelpers.classPrivateFieldLooseBase(this,_)[_]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,J)[J].bind(this),60*1e3);return}if(a.Utils.date.isSameHour(new Date,babelHelpers.classPrivateFieldLooseBase(this,X)[X])){p.Logger.desktop("StatusHandler: onWakeUp event, same hour - restart pull client");o.Core.getPullClient().restart()}else{if(this.sidePanelManager.opened){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,_)[_]);babelHelpers.classPrivateFieldLooseBase(this,_)[_]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,J)[J].bind(this),60*1e3);p.Logger.desktop("StatusHandler: onWakeUp event, slider is open, delay 60 sec");return}if(i.CallManager.getInstance().hasCurrentCall()){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,_)[_]);babelHelpers.classPrivateFieldLooseBase(this,_)[_]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,J)[J].bind(this),60*1e3);p.Logger.desktop("StatusHandler: onWakeUp event, call is active, delay 60 sec");return}p.Logger.desktop("StatusHandler: onWakeUp event, reload window");c.DesktopApi.reloadWindow()}}function ne(){c.DesktopApi.subscribe(l.EventType.desktop.onIconClick,babelHelpers.classPrivateFieldLooseBase(this,z)[z].bind(this))}function ae(){Ze.getInstance().toggleConference()}function le(){c.DesktopApi.subscribe(l.EventType.desktop.onUserAway,babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].bind(this))}function ce(e){const t=e?l.RestMethod.imUserStatusIdleStart:l.RestMethod.imUserStatusIdleEnd;o.Core.getRestClient().callMethod(t).catch((e=>{console.error(`Desktop: error in ${t}  - ${e}`)}))}function pe(){n.Event.bind(window,"focus",babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].bind(this))}function de(){n.Event.bind(window,"blur",babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].bind(this))}function be(){if(!n.Browser.isWin()||!c.DesktopApi.isChatWindow()){return}c.DesktopApi.removeNativeNotifications()}function ve(){const e=o.Core.getStore().getters["application/settings/get"](l.Settings.user.status);c.DesktopApi.setIconStatus(e)}function he(){const e=(e,t)=>t["application/settings/get"](l.Settings.user.status);o.Core.getStore().watch(e,(e=>{c.DesktopApi.setIconStatus(e)}))}var ue=babelHelpers.classPrivateFieldLooseKey("store");var ke=babelHelpers.classPrivateFieldLooseKey("subscribeToCountersChange");var ge=babelHelpers.classPrivateFieldLooseKey("onCounterChange");class Le{static init(){return new Le}constructor(){Object.defineProperty(this,ge,{value:Pe});Object.defineProperty(this,ke,{value:fe});Object.defineProperty(this,ue,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=o.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]();babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]()}}function fe(){r.EventEmitter.subscribe(l.EventType.counter.onNotificationCounterChange,babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].bind(this));r.EventEmitter.subscribe(l.EventType.counter.onChatCounterChange,babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].bind(this))}function Pe(){const e=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].getters["counters/getTotalChatCounter"];const t=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].getters["notifications/getCounter"];const s=e>0;c.DesktopApi.setCounter(e+t,s)}var Be=babelHelpers.classPrivateFieldLooseKey("bindHotkeys");class De{static init(){return new De}constructor(){Object.defineProperty(this,Be,{value:ye});babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]()}}function ye(){n.Event.bind(window,"keydown",(e=>{const t=a.Utils.key.isCombination(e,"Ctrl+R");if(t){c.DesktopApi.reloadWindow();p.Logger.desktop("NOTICE: User reload window (hotkey)");return}const s=a.Utils.key.isCombination(e,"Ctrl+Shift+L");if(s){c.DesktopApi.openLogsFolder();p.Logger.desktop("NOTICE: User open log folder (hotkey)");return}const i=a.Utils.key.isCombination(e,"Ctrl+Shift+D");if(i){c.DesktopApi.openDeveloperTools();p.Logger.desktop("NOTICE: User open developer tools (hotkey)")}}))}var Ce=babelHelpers.classPrivateFieldLooseKey("subscribeToNewTabEvent");var Fe=babelHelpers.classPrivateFieldLooseKey("onNewTabClick");class me{static init(){return new me}constructor(){Object.defineProperty(this,Fe,{value:we});Object.defineProperty(this,Ce,{value:He});babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]()}}function He(){c.DesktopApi.subscribe(l.EventType.desktop.onNewTabClick,babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].bind(this))}function we(){c.DesktopApi.createTab("/desktop/menu/")}var xe=babelHelpers.classPrivateFieldLooseKey("sendInitEvent");var Te=babelHelpers.classPrivateFieldLooseKey("initSliderBindings");var Ee=babelHelpers.classPrivateFieldLooseKey("getSliderBindingsStatus");var Oe=babelHelpers.classPrivateFieldLooseKey("initComplete");var Ae=babelHelpers.classPrivateFieldLooseKey("subscribeOnErrorEvent");var Ie=babelHelpers.classPrivateFieldLooseKey("handleInvalidAuthError");class Se{static init(){return new Se}constructor(){Object.defineProperty(this,Ie,{value:Ue});Object.defineProperty(this,Ae,{value:We});Object.defineProperty(this,Oe,{value:Ke});Object.defineProperty(this,Ee,{value:je});Object.defineProperty(this,Te,{value:$e});Object.defineProperty(this,xe,{value:Me});w.init();ie.init();U.init();M.init();Le.init();De.init();me.init();babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]();babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]();babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]();babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]()}}function Me(){const{currentUser:e}=o.Core.getApplicationData();c.DesktopApi.emit(l.EventType.desktop.onInit,[{userInfo:e!=null?e:{}}])}function $e(){const e=babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]();if(e){BX.SidePanel.Instance.enableAnchorBinding();return}BX.SidePanel.Instance.disableAnchorBinding()}function je(){const e=c.DesktopApi.getCustomSetting(c.DesktopSettingsKey.sliderBindingsStatus,"1");return e==="1"}function Ke(){c.DesktopApi.setLogInfo=function(...e){p.Logger.desktop(...e)};window.BX.debugEnable(true);c.DesktopApi.printWelcomePrompt()}function We(){r.EventEmitter.subscribe(l.EventType.request.onAuthError,(()=>babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]()))}function Ue(){return c.DesktopApi.login()}var Re=babelHelpers.classPrivateFieldLooseKey("initComplete");class Ne{static init(){return new Ne}constructor(){Object.defineProperty(this,Re,{value:Xe});me.init();babelHelpers.classPrivateFieldLooseBase(this,Re)[Re]()}}function Xe(){c.DesktopApi.setLogInfo=function(...e){p.Logger.desktop(...e)}}const _e=2;const Ve=1e3;var Je=babelHelpers.classPrivateFieldLooseKey("desktopIsActive");var Ge=babelHelpers.classPrivateFieldLooseKey("desktopActiveVersion");var ze=babelHelpers.classPrivateFieldLooseKey("locationChangedToBx");var qe=babelHelpers.classPrivateFieldLooseKey("enableRedirectCounter");var Ye=babelHelpers.classPrivateFieldLooseKey("prepareBxUrl");var Qe=babelHelpers.classPrivateFieldLooseKey("initDesktopStatus");class Ze{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){Ze.getInstance()}static isDesktop(){return c.DesktopApi.isDesktop()}static isChatWindow(){return c.DesktopApi.isChatWindow()}constructor(){Object.defineProperty(this,Qe,{value:tt});Object.defineProperty(this,Ye,{value:et});Object.defineProperty(this,Je,{writable:true,value:void 0});Object.defineProperty(this,Ge,{writable:true,value:void 0});Object.defineProperty(this,ze,{writable:true,value:false});Object.defineProperty(this,qe,{writable:true,value:1});babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]();if(Ze.isDesktop()){if(c.DesktopApi.isChatWindow()){Se.init()}else{Ne.init()}}}isDesktopActive(){if(Ze.isDesktop()){return true}return babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]}setDesktopActive(e){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=e}setDesktopVersion(e){babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=e}getDesktopVersion(){return babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]}isLocationChangedToBx(){return babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]}redirectToChat(e="",t=0){p.Logger.warn("Desktop: redirectToChat",e);let s=`bx://${l.DesktopBxLink.chat}/dialogId/${e}`;if(t>0){s+=`/messageId/${t}`}this.openBxLink(s);return Promise.resolve()}redirectToChatWithBotContext(e="",t={}){p.Logger.warn("Desktop: redirectToChatWithBotContext",e);let s=`bx://${l.DesktopBxLink.botContext}/dialogId/${e}`;if(!n.Type.isPlainObject(t)){return Promise.reject()}const i=A.encodeParamsJson(t);s+=`/context/${i}`;this.openBxLink(s);return Promise.resolve()}redirectToLines(e=""){p.Logger.warn("Desktop: redirectToLines",e);this.openBxLink(`bx://${l.DesktopBxLink.lines}/dialogId/${e}`);return Promise.resolve()}redirectToCopilot(e=""){p.Logger.warn("Desktop: redirectToCopilot",e);this.openBxLink(`bx://${l.DesktopBxLink.copilot}/dialogId/${e}`);return Promise.resolve()}redirectToCollab(e=""){p.Logger.warn("Desktop: redirectToCollab",e);this.openBxLink(`bx://${l.DesktopBxLink.collab}/dialogId/${e}`);return Promise.resolve()}redirectToNotifications(){p.Logger.warn("Desktop: redirectToNotifications");this.openBxLink(`bx://${l.DesktopBxLink.notifications}`);return Promise.resolve()}redirectToRecentSearch(){p.Logger.warn("Desktop: redirectToRecentSearch");this.openBxLink(`bx://${l.DesktopBxLink.recentSearch}`);return Promise.resolve()}redirectToConference(e){p.Logger.warn("Desktop: redirectToConference",e);this.openBxLink(`bx://${l.DesktopBxLink.conference}/code/${e}`);return Promise.resolve()}redirectToSettings(e){p.Logger.warn("Desktop: redirectToSettings",e);this.openBxLink(`bx://${l.DesktopBxLink.settings}/section/${e}`);return Promise.resolve()}openConference(e){p.Logger.warn("Desktop: openConference",e);const t=B.openConference(e);if(!t){return Promise.resolve(false)}return Promise.resolve(true)}toggleConference(){p.Logger.warn("Desktop: toggleConference");B.toggleConference()}redirectToChatCreation(e){p.Logger.warn("Desktop: redirectToChatCreation",e);this.openBxLink(`bx://${l.DesktopBxLink.chatCreation}/chatType/${e}/`);return Promise.resolve()}redirectToVideoCall(e="",t=true){p.Logger.warn("Desktop: redirectToVideoCall",e,t);const s=t?"Y":"N";this.openBxLink(`bx://${l.DesktopBxLink.call}/dialogId/${e}/withVideo/${s}`);return Promise.resolve()}redirectToPhoneCall(e,t){p.Logger.warn("Desktop: redirectToPhoneCall",e,t);const s=A.encodeParamsJson(t);this.openBxLink(`bx://${l.DesktopBxLink.phone}/number/${e}/phoneParams/${s}`);return Promise.resolve()}redirectToCallList(e,t){p.Logger.warn("Desktop: redirectToCallList",e,t);const s=A.encodeParamsJson(t);this.openBxLink(`bx://${l.DesktopBxLink.callList}/callListId/${e}/callListParams/${s}`);return Promise.resolve()}openAccountTab(e){this.openBxLink(`bx://v2/${e}/${l.DesktopBxLink.openTab}`)}openPage(e,t={}){const s=A.encodeParamsJson({url:e,options:t});this.openBxLink(`bx://${l.DesktopBxLink.openPage}/options/${s}`)}async checkStatusInDifferentContext(){if(!this.isDesktopActive()){return false}if(c.DesktopApi.isChatWindow()){return false}return L.testImageLoad()}checkForRedirect(){if(!this.isRedirectEnabled()||!this.isRedirectOptionEnabled()){return Promise.resolve(false)}return this.checkStatusInDifferentContext()}async checkForOpenBrowserPage(){if(!this.isDesktopActive()||!this.isRedirectOptionEnabled()){return false}const e=this.getDesktopVersion();if(!c.DesktopApi.isFeatureSupportedInVersion(e,c.DesktopFeature.openPage.id)){return false}return L.testImageLoad(L.IMAGE_DESKTOP_TWO_WINDOW_MODE)}isRedirectEnabled(){return babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]>0}enableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]++}disableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]--}isRedirectOptionEnabled(){if(c.DesktopApi.isDesktop()&&!c.DesktopApi.isChatWindow()){return true}return o.Core.getStore().getters["application/settings/get"](l.Settings.desktop.enableRedirect)}openBxLink(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye](e);babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=true;setTimeout((()=>{const e=new r.BaseEvent({compatData:[]});r.EventEmitter.emit(window,"BXLinkOpened",e);babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=false}),Ve);location.href=t}}function et(e){if(/^bx:\/\/v(\d)\//.test(e)){return e}return e.replace("bx://",`bx://v${_e}/${location.hostname}/`)}function tt(){const e=n.Extension.getSettings("im.v2.lib.desktop");this.setDesktopActive(e.get("desktopIsActive"));this.setDesktopVersion(e.get("desktopActiveVersion"))}e.DesktopManager=Ze})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Event,BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=desktop-manager.bundle.map.js