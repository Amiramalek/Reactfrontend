this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,n,a,o,r,l,c,h,g,d,I,u,M,m,p,v,_,b,L,C,f){"use strict";const x="BX.Messenger.v2.Lib.Menu";var y=babelHelpers.classPrivateFieldLooseKey("prepareMenuItems");var P=babelHelpers.classPrivateFieldLooseKey("filterExcessDelimiters");var E=babelHelpers.classPrivateFieldLooseKey("filterDuplicateDelimiters");var B=babelHelpers.classPrivateFieldLooseKey("filterFinishingDelimiter");var F=babelHelpers.classPrivateFieldLooseKey("isDelimiter");class A extends b.EventEmitter{constructor(){super();Object.defineProperty(this,F,{value:U});Object.defineProperty(this,B,{value:O});Object.defineProperty(this,E,{value:D});Object.defineProperty(this,P,{value:H});Object.defineProperty(this,y,{value:N});this.id="im-base-context-menu";this.setEventNamespace(x);this.store=d.Core.getStore();this.restClient=d.Core.getRestClient();this.onClosePopupHandler=this.onClosePopup.bind(this)}openMenu(e,t){if(this.menuInstance){this.close()}this.context=e;this.target=t;this.menuInstance=this.getMenuInstance();this.menuInstance.show()}getMenuInstance(){return t.MenuManager.create(this.getMenuOptions())}getMenuOptions(){return{id:this.id,bindOptions:{forceBindPosition:true,position:"bottom"},targetContainer:document.body,bindElement:this.target,cacheable:false,className:this.getMenuClassName(),items:babelHelpers.classPrivateFieldLooseBase(this,y)[y](),events:{onClose:()=>{this.emit(A.events.onCloseMenu);this.close()}}}}getMenuItems(){return[]}getMenuClassName(){return""}onClosePopup(){this.close()}close(){if(!this.menuInstance){return}this.menuInstance.destroy();this.menuInstance=null}destroy(){this.close()}getCurrentUserId(){return d.Core.getUserId()}}function N(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P](this.getMenuItems())}function H(e){const t=babelHelpers.classPrivateFieldLooseBase(this,E)[E](e);return babelHelpers.classPrivateFieldLooseBase(this,B)[B](t)}function D(e){let t=null;return e.filter((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,F)[F](t)&&babelHelpers.classPrivateFieldLooseBase(this,F)[F](e)){return false}if(e!==null){t=e}return true}))}function O(e){let t=null;return e.reverse().filter((e=>{if(t===null&&babelHelpers.classPrivateFieldLooseBase(this,F)[F](e)){return false}if(e!==null){t=e}return true})).reverse()}function U(e){return C.Type.isObjectLike(e)&&e.delimiter===true}A.events={onCloseMenu:"onCloseMenu"};const k="intranet.controller.invite.reinvite";const S="intranet.controller.invite.deleteinvitation";const T={resendInvite(e){const t={params:{userId:e}};C.ajax.runAction(k,{data:t}).then((()=>{this.showNotification(C.Loc.getMessage("IM_LIB_INVITE_RESEND_DONE"),2e3)}),(e=>{this.handleActionError(e)}))},cancelInvite(e){const t={params:{userId:e}};C.ajax.runAction(S,{data:t}).then((()=>{this.showNotification(C.Loc.getMessage("IM_LIB_INVITE_CANCEL_DONE"),2e3)}),(e=>{this.handleActionError(e)}))},showNotification(e,t=4e3){BX.UI.Notification.Center.notify({content:e,autoHideDelay:t})},handleActionError(e){if(e.status==="error"&&e.errors.length>0){const t=e.errors.map((e=>e.message)).join(". ");this.showNotification(t);return true}this.showNotification(C.Loc.getMessage("IM_LIST_RECENT_CONNECT_ERROR"))}};var w=babelHelpers.classPrivateFieldLooseKey("leaveChat");var R=babelHelpers.classPrivateFieldLooseKey("leaveCollab");class K extends A{constructor(){super();Object.defineProperty(this,R,{value:j});Object.defineProperty(this,w,{value:X});this.id="im-recent-context-menu";this.chatService=new M.ChatService;this.callManager=a.CallManager.getInstance();this.permissionManager=v.PermissionManager.getInstance()}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:32}}getMenuClassName(){return this.context.compactMode?"":super.getMenuClassName()}getMenuItems(){if(this.context.invitation.isActive){return this.getInviteItems()}return[this.getUnreadMessageItem(),this.getPinMessageItem(),this.getMuteItem(),this.getOpenProfileItem(),this.getChatsWithUserItem(),this.getHideItem(),this.getLeaveItem()]}getSendMessageItem(){return{text:C.Loc.getMessage("IM_LIB_MENU_WRITE_V2"),onclick:()=>{r.Messenger.openChat(this.context.dialogId);this.menuInstance.close()}}}getOpenItem(){return{text:C.Loc.getMessage("IM_LIB_MENU_OPEN"),onclick:()=>{r.Messenger.openChat(this.context.dialogId);this.menuInstance.close()}}}getUnreadMessageItem(){const e=this.store.getters["chats/get"](this.context.dialogId,true);const t=this.context.unread||e.counter>0;return{text:t?C.Loc.getMessage("IM_LIB_MENU_READ"):C.Loc.getMessage("IM_LIB_MENU_UNREAD"),onclick:()=>{if(t){this.chatService.readDialog(this.context.dialogId)}else{this.chatService.unreadDialog(this.context.dialogId)}this.menuInstance.close()}}}getPinMessageItem(){const e=this.context.pinned;return{text:e?C.Loc.getMessage("IM_LIB_MENU_UNPIN_MSGVER_1"):C.Loc.getMessage("IM_LIB_MENU_PIN_MSGVER_1"),onclick:()=>{if(e){this.chatService.unpinChat(this.context.dialogId)}else{this.chatService.pinChat(this.context.dialogId)}this.menuInstance.close()}}}getMuteItem(){const e=this.permissionManager.canPerformActionByRole(L.ActionByRole.mute,this.context.dialogId);if(!e){return null}const t=this.store.getters["chats/get"](this.context.dialogId,true);const s=t.muteList.includes(d.Core.getUserId());return{text:s?C.Loc.getMessage("IM_LIB_MENU_UNMUTE_2"):C.Loc.getMessage("IM_LIB_MENU_MUTE_2"),onclick:()=>{if(s){this.chatService.unmuteChat(this.context.dialogId)}else{this.chatService.muteChat(this.context.dialogId)}this.menuInstance.close()}}}getCallItem(){const e=this.callManager.chatCanBeCalled(this.context.dialogId);const t=this.permissionManager.canPerformActionByRole(L.ActionByRole.call,this.context.dialogId);if(!e||!t){return null}return{text:C.Loc.getMessage("IM_LIB_MENU_CALL_2"),onclick:()=>{o.Analytics.getInstance().onRecentStartCallClick({isGroupChat:this.context.dialogId.includes("chat"),chatId:this.context.chatId});this.callManager.startCall(this.context.dialogId);this.menuInstance.close()}}}getOpenProfileItem(){if(!this.isUser()||this.isBot()){return null}const e=p.Utils.user.getProfileLink(this.context.dialogId);return{text:C.Loc.getMessage("IM_LIB_MENU_OPEN_PROFILE_V2"),href:e,onclick:()=>{this.menuInstance.close()}}}getHideItem(){var e,t;if((e=this.context.invitation)!=null&&e.isActive||(t=this.context.options)!=null&&t.default_user_record){return null}return{text:C.Loc.getMessage("IM_LIB_MENU_HIDE_MSGVER_1"),onclick:()=>{M.RecentService.getInstance().hideChat(this.context.dialogId);this.menuInstance.close()}}}getLeaveItem(){if(this.isCollabChat()){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}return babelHelpers.classPrivateFieldLooseBase(this,w)[w]()}getChatsWithUserItem(){if(!this.isUser()||this.isBot()||this.isChatWithCurrentUser()){return null}const e=this.store.getters["application/getLayout"].entityId.length>0;return{text:C.Loc.getMessage("IM_LIB_MENU_FIND_SHARED_CHATS"),onclick:async()=>{if(!e){await r.Messenger.openChat(this.context.dialogId)}b.EventEmitter.emit(L.EventType.sidebar.open,{panel:L.SidebarDetailBlock.chatsWithUser,standalone:true,dialogId:this.context.dialogId});this.menuInstance.close()}}}getInviteItems(){const e=[this.getSendMessageItem(),this.getOpenProfileItem()];let t;if(C.Type.isUndefined(BX.MessengerProxy)){t=true;console.error("BX.MessengerProxy.canInvite() method not found in v2 version!")}else{t=BX.MessengerProxy.canInvite()}const s=t&&d.Core.getUserId()===this.context.invitation.originator;if(s){e.push(this.getDelimiter(),this.context.invitation.canResend?this.getResendInviteItem():null,this.getCancelInviteItem())}return e}getResendInviteItem(){return{text:C.Loc.getMessage("IM_LIB_INVITE_RESEND"),onclick:()=>{T.resendInvite(this.context.dialogId);this.menuInstance.close()}}}getCancelInviteItem(){return{text:C.Loc.getMessage("IM_LIB_INVITE_CANCEL"),onclick:()=>{n.MessageBox.show({message:C.Loc.getMessage("IM_LIB_INVITE_CANCEL_CONFIRM"),modal:true,buttons:n.MessageBoxButtons.OK_CANCEL,onOk:e=>{T.cancelInvite(this.context.dialogId);e.close()},onCancel:e=>{e.close()}});this.menuInstance.close()}}}getDelimiter(){return{delimiter:true}}getChat(){return this.store.getters["chats/get"](this.context.dialogId,true)}isUser(){return this.store.getters["chats/isUser"](this.context.dialogId)}isBot(){if(!this.isUser()){return false}const e=this.store.getters["users/get"](this.context.dialogId);return e.type===L.UserType.bot}isChannel(){return g.ChannelManager.isChannel(this.context.dialogId)}isCommentsChat(){const{type:e}=this.store.getters["chats/get"](this.context.dialogId,true);return e===L.ChatType.comment}isCollabChat(){const{type:e}=this.store.getters["chats/get"](this.context.dialogId,true);return e===L.ChatType.collab}isChatWithCurrentUser(){return this.getCurrentUserId()===Number.parseInt(this.context.dialogId,10)}}function X(){const e=this.permissionManager.canPerformActionByRole(L.ActionByRole.leave,this.context.dialogId);if(!e){return null}const t=this.isChannel()?C.Loc.getMessage("IM_LIB_MENU_LEAVE_CHANNEL"):C.Loc.getMessage("IM_LIB_MENU_LEAVE_MSGVER_1");return{text:t,onclick:async()=>{this.menuInstance.close();const e=await _.showLeaveChatConfirm(this.context.dialogId);if(e===true){this.chatService.leaveChat(this.context.dialogId)}}}}function j(){const e=this.permissionManager.canPerformActionByRole(L.ActionByRole.leave,this.context.dialogId);const t=this.permissionManager.canPerformActionByUserType(L.ActionByUserType.leaveCollab);if(!e||!t){return null}return{text:C.Loc.getMessage("IM_LIB_MENU_LEAVE_MSGVER_1"),onclick:async()=>{this.menuInstance.close();const e=await _.showLeaveChatConfirm(this.context.dialogId);if(!e){return}this.chatService.leaveCollab(this.context.dialogId)}}}var G=babelHelpers.classPrivateFieldLooseKey("getKickItemText");var V=babelHelpers.classPrivateFieldLooseKey("kickUser");class W extends A{constructor(){super();Object.defineProperty(this,V,{value:Y});Object.defineProperty(this,G,{value:z});this.id="bx-im-user-context-menu";this.permissionManager=v.PermissionManager.getInstance()}getKickItem(){const e=this.permissionManager.canPerformActionByRole(L.ActionByRole.kick,this.context.dialog.dialogId);if(!e){return null}return{text:babelHelpers.classPrivateFieldLooseBase(this,G)[G](),onclick:async()=>{this.menuInstance.close();const e=await _.showKickUserConfirm(this.context.dialog.dialogId);if(e!==true){return}void babelHelpers.classPrivateFieldLooseBase(this,V)[V]()}}}getMentionItem(){return{text:C.Loc.getMessage("IM_LIB_MENU_USER_MENTION"),onclick:()=>{b.EventEmitter.emit(L.EventType.textarea.insertMention,{mentionText:this.context.user.name,mentionReplacement:p.Utils.text.getMentionBbCode(this.context.user.id,this.context.user.name),dialogId:this.context.dialog.dialogId,isMentionSymbol:false});this.menuInstance.close()}}}getSendItem(){if(this.context.dialog.type===L.ChatType.user){return null}return{text:C.Loc.getMessage("IM_LIB_MENU_USER_WRITE"),onclick:()=>{void r.Messenger.openChat(this.context.user.id);this.menuInstance.close()}}}getProfileItem(){if(this.isBot()){return null}const e=p.Utils.user.getProfileLink(this.context.user.id);return{text:C.Loc.getMessage("IM_LIB_MENU_OPEN_PROFILE_V2"),href:e,onclick:()=>{this.menuInstance.close()}}}isCollabChat(){const{type:e}=this.store.getters["chats/get"](this.context.dialog.dialogId,true);return e===L.ChatType.collab}isBot(){return this.context.user.type===L.UserType.bot}}function z(){if(this.isCollabChat()){return C.Loc.getMessage("IM_LIB_MENU_USER_KICK_FROM_COLLAB")}return C.Loc.getMessage("IM_LIB_MENU_USER_KICK_FROM_CHAT")}function Y(){if(this.isCollabChat()){return(new M.ChatService).kickUserFromCollab(this.context.dialog.dialogId,this.context.user.id)}return(new M.ChatService).kickUserFromChat(this.context.dialog.dialogId,this.context.user.id)}var q=babelHelpers.classPrivateFieldLooseKey("isOwnMessage");var $=babelHelpers.classPrivateFieldLooseKey("isDeletedMessage");var J=babelHelpers.classPrivateFieldLooseKey("getFirstFile");var Q=babelHelpers.classPrivateFieldLooseKey("isSingleFile");var Z=babelHelpers.classPrivateFieldLooseKey("isForwardedMessage");var ee=babelHelpers.classPrivateFieldLooseKey("isRealMessage");var te=babelHelpers.classPrivateFieldLooseKey("onDelete");var se=babelHelpers.classPrivateFieldLooseKey("isDeletionCancelled");var ie=babelHelpers.classPrivateFieldLooseKey("getDownloadSingleFileItem");var ne=babelHelpers.classPrivateFieldLooseKey("getDownloadSeveralFilesItem");var ae=babelHelpers.classPrivateFieldLooseKey("arePinsExceedLimit");var oe=babelHelpers.classPrivateFieldLooseKey("showNotifier");class re extends A{constructor(){super();Object.defineProperty(this,oe,{value:_e});Object.defineProperty(this,ae,{value:ve});Object.defineProperty(this,ne,{value:pe});Object.defineProperty(this,ie,{value:me});Object.defineProperty(this,se,{value:Me});Object.defineProperty(this,te,{value:ue});Object.defineProperty(this,ee,{value:Ie});Object.defineProperty(this,Z,{value:de});Object.defineProperty(this,Q,{value:ge});Object.defineProperty(this,J,{value:he});Object.defineProperty(this,$,{value:ce});Object.defineProperty(this,q,{value:le});this.maxPins=20;this.id="bx-im-message-context-menu";this.diskService=new M.DiskService;this.marketManager=m.MarketManager.getInstance()}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:11}}getMenuItems(){return[this.getReplyItem(),this.getCopyItem(),this.getCopyLinkItem(),this.getCopyFileItem(),this.getPinItem(),this.getForwardItem(),this.getDelimiter(),this.getMarkItem(),this.getFavoriteItem(),this.getDelimiter(),this.getCreateItem(),this.getDelimiter(),this.getDownloadFileItem(),this.getSaveToDiskItem(),this.getDelimiter(),this.getEditItem(),this.getDeleteItem(),this.getDelimiter(),this.getSelectItem()]}getSelectItem(){if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]()||!babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()){return null}return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_SELECT"),onclick:()=>{b.EventEmitter.emit(L.EventType.dialog.openBulkActionsMode,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getReplyItem(){return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_REPLY"),onclick:()=>{b.EventEmitter.emit(L.EventType.textarea.replyMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getForwardItem(){if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]()||!babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()){return null}return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_FORWARD"),onclick:()=>{b.EventEmitter.emit(L.EventType.dialog.showForwardPopup,{messagesIds:[this.context.id]});this.menuInstance.close()}}}getCopyItem(){if(this.context.text.trim().length===0){return null}return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY"),onclick:async()=>{const e=I.Parser.prepareCopy(this.context);await p.Utils.text.copyToClipboard(e);BX.UI.Notification.Center.notify({content:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_SUCCESS")});this.menuInstance.close()}}}getCopyLinkItem(){return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_LINK_MSGVER_1"),onclick:()=>{var e;const t=p.Utils.text.getMessageLink(this.context.dialogId,this.context.id);if((e=BX.clipboard)!=null&&e.copy(t)){BX.UI.Notification.Center.notify({content:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_LINK_SUCCESS")})}this.menuInstance.close()}}}getCopyFileItem(){if(this.context.files.length!==1){return null}return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE"),onclick:()=>{var e;const t=I.Parser.prepareCopyFile(this.context);if((e=BX.clipboard)!=null&&e.copy(t)){BX.UI.Notification.Center.notify({content:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE_SUCCESS")})}this.menuInstance.close()}}}getPinItem(){const e=v.PermissionManager.getInstance().canPerformActionByRole(L.ActionByRole.pinMessage,this.context.dialogId);if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]()||!e){return null}const t=this.store.getters["messages/pin/isPinned"]({chatId:this.context.chatId,messageId:this.context.id});return{text:t?C.Loc.getMessage("IM_DIALOG_CHAT_MENU_UNPIN"):C.Loc.getMessage("IM_DIALOG_CHAT_MENU_PIN"),onclick:()=>{const e=new M.MessageService({chatId:this.context.chatId});if(t){e.unpinMessage(this.context.chatId,this.context.id)}else{if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()){const e=C.Loc.getMessage("IM_DIALOG_CHAT_PINNED_MAX_REACHED",{"#MAX_PINS#":this.maxPins});babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](e);return}e.pinMessage(this.context.chatId,this.context.id)}this.menuInstance.close()}}}getFavoriteItem(){if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]()){return null}const e=this.store.getters["sidebar/favorites/isFavoriteMessage"](this.context.chatId,this.context.id);const t=e?C.Loc.getMessage("IM_DIALOG_CHAT_MENU_REMOVE_FROM_SAVED"):C.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE");return{text:t,onclick:()=>{const t=new M.MessageService({chatId:this.context.chatId});if(e){t.removeMessageFromFavorite(this.context.id)}else{t.addMessageToFavorite(this.context.id)}this.menuInstance.close()}}}getMarkItem(){const e=this.context.viewed&&!babelHelpers.classPrivateFieldLooseBase(this,q)[q]();const t=this.store.getters["chats/getByChatId"](this.context.chatId);const s=this.context.id===t.markedId;if(!e||s){return null}return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_MARK"),onclick:()=>{const e=new M.MessageService({chatId:this.context.chatId});e.markMessage(this.context.id);this.menuInstance.close()}}}getCreateItem(){if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]()){return null}return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE"),items:[this.getCreateTaskItem(),this.getCreateMeetingItem(),...this.getMarketItems()]}}getCreateTaskItem(){return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_TASK"),onclick:()=>{const e=new u.EntityCreator(this.context.chatId);void e.createTaskForMessage(this.context.id);this.menuInstance.close()}}}getCreateMeetingItem(){return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_MEETING"),onclick:()=>{const e=new u.EntityCreator(this.context.chatId);void e.createMeetingForMessage(this.context.id);this.menuInstance.close()}}}getEditItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,q)[q]()||babelHelpers.classPrivateFieldLooseBase(this,$)[$]()||babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]()){return null}return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_EDIT"),onclick:()=>{b.EventEmitter.emit(L.EventType.textarea.editMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getDeleteItem(){if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]()){return null}const e=v.PermissionManager.getInstance();const t=e.canPerformActionByRole(L.ActionByRole.deleteOthersMessage,this.context.dialogId);if(!babelHelpers.classPrivateFieldLooseBase(this,q)[q]()&&!t){return null}return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_DELETE"),className:"menu-popup-no-icon bx-im-dialog-chat__message-menu_delete",onclick:babelHelpers.classPrivateFieldLooseBase(this,te)[te].bind(this)}}getMarketItems(){const{dialogId:e,id:t}=this.context;const s=this.marketManager.getAvailablePlacementsByType(L.PlacementType.contextMenu,e);const i=[];if(s.length>0){i.push(this.getDelimiter())}const n={messageId:t,dialogId:e};s.forEach((e=>{i.push({text:e.title,onclick:()=>{m.MarketManager.openSlider(e,n);this.menuInstance.close()}})}));const a=11;return i.slice(0,a)}getDownloadFileItem(){if(!C.Type.isArrayFilled(this.context.files)){return null}if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()){return babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]()}return babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]()}getSaveToDiskItem(){if(!C.Type.isArrayFilled(this.context.files)){return null}const e=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()?C.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_MSGVER_1"):C.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ALL_ON_DISK");const t=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()?C.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_SUCCESS_MSGVER_1"):C.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ALL_ON_DISK_SUCCESS");return{text:e,onclick:function(){h.Analytics.getInstance().messageFiles.onClickSaveOnDisk({messageId:this.context.id,dialogId:this.context.dialogId});void this.diskService.save(this.context.files).then((()=>{BX.UI.Notification.Center.notify({content:t})}));this.menuInstance.close()}.bind(this)}}getDelimiter(){return{delimiter:true}}}function le(){return this.context.authorId===d.Core.getUserId()}function ce(){return this.context.isDeleted}function he(){return this.store.getters["files/get"](this.context.files[0])}function ge(){return this.context.files.length===1}function de(){return C.Type.isStringFilled(this.context.forward.id)}function Ie(){return this.store.getters["messages/isRealMessage"](this.context.id)}async function ue(){const{id:e,dialogId:t,chatId:s}=this.context;h.Analytics.getInstance().messageDelete.onClickDelete({messageId:e,dialogId:t});this.menuInstance.close();if(await babelHelpers.classPrivateFieldLooseBase(this,se)[se]()){return}const i=new M.MessageService({chatId:s});void i.deleteMessages([e])}async function Me(){const{id:e,dialogId:t}=this.context;if(!g.ChannelManager.isChannel(t)){return false}const s=await _.showDeleteChannelPostConfirm();if(!s){h.Analytics.getInstance().messageDelete.onCancel({messageId:e,dialogId:t});return true}return false}function me(){const e=babelHelpers.classPrivateFieldLooseBase(this,J)[J]();return{html:p.Utils.file.createDownloadLink(C.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILE"),e.urlDownload,e.name),onclick:function(){h.Analytics.getInstance().messageFiles.onClickDownload({messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}.bind(this)}}function pe(){const e=this.context.files.map((e=>this.store.getters["files/get"](e)));return{text:C.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILES"),onclick:async()=>{var t;h.Analytics.getInstance().messageFiles.onClickDownload({messageId:this.context.id,dialogId:this.context.dialogId});p.Utils.file.downloadFiles(e);const s=c.PromoManager.getInstance().needToShow(L.PromoId.downloadSeveralFiles);if(s&&p.Utils.browser.isChrome()&&!p.Utils.platform.isBitrixDesktop()){var i;(i=this.menuInstance)==null?void 0:i.close();await _.showDownloadAllFilesConfirm();void c.PromoManager.getInstance().markAsWatched(L.PromoId.downloadSeveralFiles)}(t=this.menuInstance)==null?void 0:t.close()}}}function ve(){const e=this.store.getters["messages/pin/getPinned"](this.context.chatId);return e.length>=this.maxPins}function _e(e){BX.UI.Notification.Center.notify({content:e})}class be extends re{getMenuItems(){return[this.getCopyItem(),this.getCopyLinkItem(),this.getCopyFileItem(),this.getPinItem(),this.getForwardItem(),this.getDelimiter(),this.getMarkItem(),this.getFavoriteItem(),this.getDelimiter(),this.getDownloadFileItem(),this.getSaveToDiskItem(),this.getDelimiter(),this.getEditItem(),this.getDeleteItem(),this.getDelimiter(),this.getSelectItem()]}}class Le extends re{getMenuItems(){if(this.isPostMessage()){return[this.getCopyItem(),this.getCopyFileItem(),this.getDelimiter(),this.getDownloadFileItem(),this.getSaveToDiskItem(),this.getDelimiter(),this.getOpenInChannelItem()]}return[this.getReplyItem(),this.getCopyItem(),this.getCopyFileItem(),this.getDelimiter(),this.getFavoriteItem(),this.getDelimiter(),this.getCreateItem(),this.getDelimiter(),this.getDownloadFileItem(),this.getSaveToDiskItem(),this.getDelimiter(),this.getEditItem(),this.getDeleteItem()]}getOpenInChannelItem(){return{text:C.Loc.getMessage("IM_LIB_MENU_COMMENTS_OPEN_IN_CHANNEL"),onclick:()=>{b.EventEmitter.emit(L.EventType.dialog.closeComments);this.menuInstance.close()}}}isPostMessage(){const{dialogId:e}=this.store.getters["chats/getByChatId"](this.context.chatId);return e!==this.context.dialogId}}const Ce=Object.freeze({personal:"chat_copilot_tab_one_by_one",group:"chat_copilot_tab_multi"});class fe extends re{getMenuItems(){return[this.getCopyItem(),this.getFavoriteItem(),this.getForwardItem(),this.getSendFeedbackItem(),this.getDeleteItem(),this.getSelectItem()]}getSendFeedbackItem(){const e=new f.CopilotManager;if(!e.isCopilotBot(this.context.authorId)){return null}return{text:C.Loc.getMessage("IM_LIB_MENU_COPILOT_FEEDBACK"),onclick:()=>{void this.openForm();this.menuInstance.close()}}}async openForm(){const e=Math.round(Math.random()*1e3);await C.Runtime.loadExtension(["ui.feedback.form"]);BX.UI.Feedback.Form.open({id:`im.copilot.feedback-${e}`,forms:[{zones:["es"],id:684,lang:"es",sec:"svvq1x"},{zones:["en"],id:686,lang:"en",sec:"tjwodz"},{zones:["de"],id:688,lang:"de",sec:"nrwksg"},{zones:["com.br"],id:690,lang:"com.br",sec:"kpte6m"},{zones:["ru","by","kz"],id:692,lang:"ru",sec:"jbujn0"}],presets:{sender_page:this.getCopilotChatContext(),language:C.Loc.getMessage("LANGUAGE_ID"),cp_answer:this.context.text}})}getCopilotChatContext(){const e=this.store.getters["chats/get"](this.context.dialogId);if(e.userCounter<=2){return Ce.personal}return Ce.group}}var xe=babelHelpers.classPrivateFieldLooseKey("instance");var ye=babelHelpers.classPrivateFieldLooseKey("menuByCallback");var Pe=babelHelpers.classPrivateFieldLooseKey("menuByMessageType");var Ee=babelHelpers.classPrivateFieldLooseKey("registerDefaultMenus");var Be=babelHelpers.classPrivateFieldLooseKey("getDialog");var Fe=babelHelpers.classPrivateFieldLooseKey("isChannel");var Ae=babelHelpers.classPrivateFieldLooseKey("isComment");var Ne=babelHelpers.classPrivateFieldLooseKey("isCopilot");var He=babelHelpers.classPrivateFieldLooseKey("hasMenuForMessageType");var De=babelHelpers.classPrivateFieldLooseKey("getMenuForMessageType");class Oe{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]){babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=new Oe}return babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]}constructor(){Object.defineProperty(this,De,{value:Ke});Object.defineProperty(this,He,{value:Re});Object.defineProperty(this,Ne,{value:we});Object.defineProperty(this,Ae,{value:Te});Object.defineProperty(this,Fe,{value:Se});Object.defineProperty(this,Be,{value:ke});Object.defineProperty(this,Ee,{value:Ue});Object.defineProperty(this,ye,{writable:true,value:new Map});Object.defineProperty(this,Pe,{writable:true,value:new Map});babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]()}openMenu(e,t){if(babelHelpers.classPrivateFieldLooseBase(this,He)[He](e.componentId)){const s=babelHelpers.classPrivateFieldLooseBase(this,De)[De](e.componentId);(new s).openMenu(e,t);return}const s=[...babelHelpers.classPrivateFieldLooseBase(this,ye)[ye].entries()].reverse();for(const[i,n]of s){if(i(e)){(new n).openMenu(e,t);return}}(new re).openMenu(e,t)}registerMenuByCallback(e,t){babelHelpers.classPrivateFieldLooseBase(this,ye)[ye].set(e,t)}registerMenuByMessageType(e,t){if(babelHelpers.classPrivateFieldLooseBase(this,He)[He](e)){return}babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].set(e,t)}}function Ue(){this.registerMenuByCallback(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].bind(this),be);this.registerMenuByCallback(babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].bind(this),Le);this.registerMenuByCallback(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne].bind(this),fe)}function ke(e){return d.Core.getStore().getters["chats/get"](e,true)}function Se(e){return g.ChannelManager.isChannel(e.dialogId)}function Te(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](e.dialogId);return t.type===L.ChatType.comment}function we(e){return(new f.CopilotManager).isCopilotChat(e.dialogId)}function Re(e){return babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].has(e)}function Ke(e){return babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].get(e)}Object.defineProperty(Oe,xe,{writable:true,value:null});e.BaseMenu=A;e.RecentMenu=K;e.UserMenu=W;e.MessageMenuManager=Oe;e.MessageMenu=re})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Main,BX.Vue3.Vuex,BX,BX.UI.Dialogs,BX.Messenger.v2.Lib,BX.Call.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Event,BX.Messenger.v2.Const,BX,BX.Messenger.v2.Lib);
//# sourceMappingURL=registry.bundle.map.js