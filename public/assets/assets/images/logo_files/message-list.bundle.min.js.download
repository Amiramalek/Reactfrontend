this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,a,i,o,r,n,l,g,d,c,u,p,m,h,M,v,b,I,B,y,C,f,L,_,S,P,A,E,F,x,T,k,H,D,G,w,X,O,N,U,K,j,$,R){"use strict";const q={name:"DialogLoader",props:{fullHeight:{type:Boolean,default:true}},data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-dialog-loader__container" :class="{'--full-height': fullHeight}">\n\t\t\t<div class="bx-im-dialog-loader__spinner"></div>\n\t\t\t<div class="bx-im-dialog-loader__text">{{ loc('IM_DIALOG_CHAT_LOADER_TEXT') }}</div>\n\t\t</div>\n\t`};class V extends o.UserMenu{constructor(){super();this.id="bx-im-avatar-context-menu"}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:21}}getMenuItems(){const e=this.context.user.id===m.Core.getUserId();if(e){return[this.getProfileItem()]}return[this.getMentionItem(),this.getSendItem(),this.getProfileItem(),this.getKickItem()]}}var z=babelHelpers.classPrivateFieldLooseKey("dialogId");var Y=babelHelpers.classPrivateFieldLooseKey("observer");var Q=babelHelpers.classPrivateFieldLooseKey("initObserver");var Z=babelHelpers.classPrivateFieldLooseKey("sendVisibleEvent");var J=babelHelpers.classPrivateFieldLooseKey("sendNotVisibleEvent");var W=babelHelpers.classPrivateFieldLooseKey("getThreshold");var ee=babelHelpers.classPrivateFieldLooseKey("getMessageIdFromElement");class te{constructor(e){Object.defineProperty(this,ee,{value:re});Object.defineProperty(this,W,{value:oe});Object.defineProperty(this,J,{value:ie});Object.defineProperty(this,Z,{value:ae});Object.defineProperty(this,Q,{value:se});Object.defineProperty(this,z,{writable:true,value:void 0});Object.defineProperty(this,Y,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()}observeMessage(e){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].observe(e)}unobserveMessage(e){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].unobserve(e)}}function se(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=new IntersectionObserver((e=>{e.forEach((e=>{const t=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](e.target);if(!t||!e.rootBounds){return}const s=e.isIntersecting&&e.intersectionRatio>=.99;const a=e.intersectionRect.height>=e.rootBounds.height/2.2;if(s||a){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](t)}else{babelHelpers.classPrivateFieldLooseBase(this,J)[J](t)}}))}),{threshold:babelHelpers.classPrivateFieldLooseBase(this,W)[W]()})}function ae(e){c.EventEmitter.emit(h.EventType.dialog.onMessageIsVisible,{messageId:e,dialogId:babelHelpers.classPrivateFieldLooseBase(this,z)[z]})}function ie(e){c.EventEmitter.emit(h.EventType.dialog.onMessageIsNotVisible,{messageId:e,dialogId:babelHelpers.classPrivateFieldLooseBase(this,z)[z]})}function oe(){const e=Array.from({length:101}).fill(0);return e.map(((e,t)=>t*.01))}function re(e){return Number(e.dataset.id)}const ne={props:{title:{type:String,required:true}},data(){return{}},template:`\n\t\t<div class="bx-im-message-list-date-group-title__container">\n\t\t\t<div class="bx-im-message-list-date-group-title__text">{{ title }}</div>\n\t\t</div>\n\t`};const le={name:"DateGroup",components:{DateGroupTitle:ne},props:{item:{type:Object,required:true}},data(){return{}},computed:{BlockType:()=>h.DialogBlockType,dateGroup(){return this.item}},template:`\n\t\t<div class="bx-im-message-list-date-group__container">\n\t\t\t<DateGroupTitle :title="dateGroup.dateTitle" />\n\t\t\t<template v-for="dateGroupItem in dateGroup.items" >\n\t\t\t\t<slot\n\t\t\t\t\tname="dateGroupItem"\n\t\t\t\t\t:dateGroupItem="dateGroupItem"\n\t\t\t\t\t:isMarkedBlock="dateGroupItem.type === BlockType.markedMessages"\n\t\t\t\t\t:isNewMessagesBlock="dateGroupItem.type === BlockType.newMessages"\n\t\t\t\t\t:isAuthorBlock="dateGroupItem.type === BlockType.authorGroup"\n\t\t\t\t></slot>\n\t\t\t</template>\n\t\t</div>\n\t`};const ge=new Set([h.MessageComponent.default,h.MessageComponent.copilotMessage,h.MessageComponent.checkIn,h.MessageComponent.FeedbackFormMessage,h.MessageComponent.ImOpenLinesMessage,h.MessageComponent.ImOpenLinesForm]);const de={name:"MessageSelectButton",props:{contextDialogId:{type:String,required:true},message:{type:Object,required:true}},computed:{messageItem(){return this.message},selectedMessages(){return this.$store.getters["messages/select/getCollection"](this.contextDialogId)},bulkActionMessageLimit(){const e=d.Extension.getSettings("im.v2.component.message-list");return e.get("multipleActionMessageLimit")},isMessageSelected(){return this.$store.getters["messages/select/isMessageSelected"](this.messageItem.id,this.contextDialogId)},isSelectionLimitReached(){return this.selectedMessages.size===this.bulkActionMessageLimit&&!this.isMessageSelected},isRealMessage(){return this.$store.getters["messages/isRealMessage"](this.messageItem.id)},canSelectMessage(){if(this.messageItem.isDeleted||!this.isRealMessage){return false}return ge.has(this.messageItem.componentId)}},methods:{onSelectMessage(){if(!this.canSelectMessage){return}if(this.isSelectionLimitReached){this.showNotification(this.loc("IM_MESSAGE_LIST_MAX_LIMIT_SELECTED_MESSAGES"));return}this.$store.dispatch("messages/select/toggleMessageSelection",{messageId:this.messageItem.id,dialogId:this.contextDialogId})},showNotification(e){BX.UI.Notification.Center.notify({content:e})},loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div @click="onSelectMessage" class="bx-im-message-list-select-button__container">\n\t\t\t<div\n\t\t\t\tv-if="canSelectMessage"\n\t\t\t\tclass="bx-im-message-list-select-button__checkbox-circle"\n\t\t\t\t:class="{'--selected': isMessageSelected}"\n\t\t\t/>\n\t\t</div>\n\t`};const ce={name:"AuthorGroup",components:{MessageAvatar:n.MessageAvatar,MessageSelectButton:de},props:{item:{type:Object,required:true},contextDialogId:{type:String,required:true},withAvatarMenu:{type:Boolean,default:true}},emits:["avatarClick"],computed:{AvatarSize:()=>n.AvatarSize,contextDialog(){return this.$store.getters["chats/get"](this.contextDialogId,true)},contextUser(){return this.$store.getters["users/get"](this.contextDialogId,true)},isUser(){return this.contextDialog.type===h.ChatType.user},isBulkActionsMode(){return this.$store.getters["messages/select/isBulkActionsModeActive"](this.contextDialogId)},authorGroup(){return this.item},authorDialogId(){return this.authorGroup.avatar.avatarId},firstMessageIdInAuthorGroup(){return this.authorGroup.messages[0].id},avatarMenuAvailable(){if(!this.withAvatarMenu){return false}const e=this.$store.getters["users/get"](this.authorDialogId);if(!e){return false}const t=new l.CopilotManager;if(t.isCopilotBot(this.authorDialogId)){return false}const s=this.isUser&&this.contextUser.type===h.UserType.bot;if(s){return false}const a=g.PermissionManager.getInstance();return a.canPerformActionByRole(h.ActionByRole.openAvatarMenu,this.contextDialogId)},containerClasses(){const e=[`--${this.authorGroup.messageType}`];if(!this.avatarMenuAvailable){e.push("--no-menu")}if(this.isBulkActionsMode){e.push("--is-bulk-actions-mode")}if(this.authorGroup.avatar.isNeeded){e.push("--has-avatar")}return e}},methods:{isAvatarNeeded(e){const t=this.authorGroup.messages.length-1;return this.authorGroup.avatar.isNeeded&&e===t},onAvatarClick(e){if(!this.avatarMenuAvailable){return}this.$emit("avatarClick",{dialogId:this.authorGroup.avatar.avatarId,$event:e})},loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-author-group__container" :class="containerClasses">\n\t\t\t<template v-for="(message, index) in authorGroup.messages">\n\t\t\t\t<Transition name="bx-im-select-button-transition">\n\t\t\t\t\t<MessageSelectButton v-if="isBulkActionsMode" :contextDialogId="contextDialogId" :message="message" />\n\t\t\t\t</Transition>\n\t\t\t\t<div v-if="isAvatarNeeded(index)" class="bx-im-message-list-author-group__avatar">\n\t\t\t\t\t<MessageAvatar\n\t\t\t\t\t\t:messageId="firstMessageIdInAuthorGroup"\n\t\t\t\t\t\t:authorId="authorGroup.avatar.avatarId"\n\t\t\t\t\t\t:size="AvatarSize.L"\n\t\t\t\t\t\t@click="onAvatarClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<slot name="message" :message="message" :index="index"></slot>\n\t\t\t</template>\n\t\t</div>\n\t`};const ue={data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-new-message__container">\n\t\t\t<div class="bx-im-message-list-new-message__text">\n\t\t\t\t{{ loc('IM_DIALOG_CHAT_BLOCK_NEW_MESSAGES_2') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const pe={data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-new-message__container">\n\t\t\t<div class="bx-im-message-list-new-message__text">\n\t\t\t\t{{ loc('IM_DIALOG_CHAT_BLOCK_MARKED_MESSAGES') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const me=[d.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_1"),d.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_2"),d.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_3"),d.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_4"),d.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_5")];const he={name:"EmptyState",props:{dialogId:{type:String,required:true}},data(){return{}},computed:{defaultMessages:()=>me},methods:{onMessageClick(e){c.EventEmitter.emit(h.EventType.textarea.insertText,{text:e,dialogId:this.dialogId})},loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-empty-state__container">\n\t\t\t<div class="bx-im-message-list-empty-state__content">\n\t\t\t\t<div class="bx-im-message-list-empty-state__icon"></div>\n\t\t\t\t<div class="bx-im-message-list-empty-state__title">{{ loc('IM_MESSAGE_LIST_EMPTY_STATE_TITLE') }}</div>\n\t\t\t\t<div class="bx-im-message-list-empty-state__action-list">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for="(message, index) in defaultMessages"\n\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\t@click="onMessageClick(message)"\n\t\t\t\t\t\tclass="bx-im-message-list-empty-state__action-list_item"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ message }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Me={name:"HistoryLimitBanner",props:{noMessages:{type:Boolean,required:true},dialogId:{type:String,required:true}},computed:{title(){return p.FeatureManager.chatHistory.getLimitTitle()},subtitle(){return p.FeatureManager.chatHistory.getLimitSubtitle()},buttonText(){return p.FeatureManager.chatHistory.getLearnMoreText()}},mounted(){this.sendAnalytics()},methods:{onButtonClick(){u.Analytics.getInstance().historyLimit.onDialogBannerClick({dialogId:this.dialogId});p.FeatureManager.chatHistory.openFeatureSlider()},sendAnalytics(){u.Analytics.getInstance().historyLimit.onDialogLimitExceeded({dialogId:this.dialogId,noMessages:this.noMessages})}},template:`\n\t\t<div class="bx-im-message-list-history-banner__container" :class="{'--no-messages': noMessages}">\n\t\t\t<div class="bx-im-message-list-history-banner__left">\n\t\t\t\t<div class="bx-im-message-list-history-banner__title">\n\t\t\t\t\t<div class="bx-im-message-list-history-banner__icon bx-im-messenger__lock-icon"></div>\n\t\t\t\t\t<div class="bx-im-message-list-history-banner__title_text --ellipsis" :title="title">\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-message-list-history-banner__subtitle --line-clamp-2" :title="subtitle">\n\t\t\t\t\t{{ subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-message-list-history-banner__right">\n\t\t\t\t<div class="bx-im-message-list-history-banner__button" @click="onButtonClick">\n\t\t\t\t\t{{ buttonText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};var ve=babelHelpers.classPrivateFieldLooseKey("getAvatarConfig");var be=babelHelpers.classPrivateFieldLooseKey("getMessageType");var Ie=babelHelpers.classPrivateFieldLooseKey("checkIfAvatarIsNeeded");class Be{constructor(){Object.defineProperty(this,Ie,{value:fe});Object.defineProperty(this,be,{value:Ce});Object.defineProperty(this,ve,{value:ye})}getAuthorBlock(e){return{type:h.DialogBlockType.authorGroup,userId:e.authorId,avatar:babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e),messageType:babelHelpers.classPrivateFieldLooseBase(this,be)[be](e)}}getMarkedBlock(){return{type:h.DialogBlockType.markedMessages}}getNewMessagesBlock(){return{type:h.DialogBlockType.newMessages}}}function ye(e){return{isNeeded:babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie](e),avatarId:e.authorId.toString()}}function Ce(e){if(!e.authorId){return h.MessageType.system}if(e.authorId===m.Core.getUserId()){return h.MessageType.self}return h.MessageType.opponent}function fe(e){const t=babelHelpers.classPrivateFieldLooseBase(this,be)[be](e);const s=t===h.MessageType.system;if(s){return false}const a=t===h.MessageType.self;const i=m.Core.getStore().getters["application/settings/get"](h.Settings.appearance.alignment);if(i===h.DialogAlignment.center){return!a}return true}var Le=babelHelpers.classPrivateFieldLooseKey("blockManager");var _e=babelHelpers.classPrivateFieldLooseKey("collection");var Se=babelHelpers.classPrivateFieldLooseKey("currentDateTitles");var Pe=babelHelpers.classPrivateFieldLooseKey("markedIndicatorInserted");var Ae=babelHelpers.classPrivateFieldLooseKey("lastDateItems");var Ee=babelHelpers.classPrivateFieldLooseKey("lastAuthorId");var Fe=babelHelpers.classPrivateFieldLooseKey("lastAuthorItems");var xe=babelHelpers.classPrivateFieldLooseKey("clearLastAuthor");class Te{constructor(){Object.defineProperty(this,xe,{value:ke});Object.defineProperty(this,Le,{writable:true,value:void 0});Object.defineProperty(this,_e,{writable:true,value:[]});Object.defineProperty(this,Se,{writable:true,value:new Set});Object.defineProperty(this,Pe,{writable:true,value:false});Object.defineProperty(this,Ae,{writable:true,value:[]});Object.defineProperty(this,Ee,{writable:true,value:null});Object.defineProperty(this,Fe,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]=new Be}get(){return babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]}hasDateTitle(e){return babelHelpers.classPrivateFieldLooseBase(this,Se)[Se].has(e)}addDateGroup(e){babelHelpers.classPrivateFieldLooseBase(this,Se)[Se].add(e);babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]=[];babelHelpers.classPrivateFieldLooseBase(this,_e)[_e].push({dateTitle:e,items:babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]});babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]()}addAuthorGroup(e){babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]=e.authorId;babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=[];babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].push({...babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].getAuthorBlock(e),messages:babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]})}addMessage(e){babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].push(e)}addMarkedIndicator(){babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].push(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].getMarkedBlock());babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=true;babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]()}addNewMessagesIndicator(){if(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]){return}babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].push(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].getNewMessagesBlock());babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]()}getLastAuthorId(){return babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]}}function ke(){babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]=null}var He=babelHelpers.classPrivateFieldLooseKey("getLocalShortDate");class De{constructor(){Object.defineProperty(this,He,{value:Ge});this.cachedDateGroups={}}getDateTitle(e){const t=babelHelpers.classPrivateFieldLooseBase(this,He)[He](e);if(this.cachedDateGroups[t]){return this.cachedDateGroups[t]}this.cachedDateGroups[t]=M.DateFormatter.formatByTemplate(e,M.DateTemplate.dateGroup);return this.cachedDateGroups[t]}}function Ge(e){const t=e.getTime()-e.getTimezoneOffset()*6e4;const s=new Date(t).toJSON();const a=10;return s.slice(0,a)}var we=babelHelpers.classPrivateFieldLooseKey("setInitialValues");var Xe=babelHelpers.classPrivateFieldLooseKey("handleMarkedMessageId");var Oe=babelHelpers.classPrivateFieldLooseKey("getLastReadMessageId");var Ne=babelHelpers.classPrivateFieldLooseKey("getDialog");class Ue{constructor(e){Object.defineProperty(this,Ne,{value:Re});Object.defineProperty(this,Oe,{value:$e});Object.defineProperty(this,Xe,{value:je});Object.defineProperty(this,we,{value:Ke});this.firstIteration=true;this.dialogId=e;this.dateManager=new De}formatMessageCollection(e){const t=new Te;babelHelpers.classPrivateFieldLooseBase(this,we)[we]();babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]();e.forEach(((s,a)=>{const i=this.dateManager.getDateTitle(s.date);if(!t.hasDateTitle(i)){t.addDateGroup(i)}if(s.id===this.markedMessageId){t.addMarkedIndicator()}if(s.authorId!==t.getLastAuthorId()){t.addAuthorGroup(s)}t.addMessage(s);const o=a===e.length-1;if(!o&&s.id===this.lastReadMessageId){t.addNewMessagesIndicator()}}));const{inited:s}=babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]();if(s){this.firstIteration=false}return t.get()}formatAuthorGroup(e){const t=new Be;return{...t.getAuthorBlock(e),messages:[e]}}}function Ke(){if(!this.firstIteration){return}const{markedId:e}=babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]();this.lastReadMessageId=babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]();this.markedMessageId=e}function je(){const{markedId:e}=babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]();if(e===this.markedMessageId||e===0){return}this.markedMessageId=e;this.lastReadMessageId=null}function $e(){const{lastMessageId:e}=babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]();const t=m.Core.getStore().getters["chats/getLastReadId"](this.dialogId);if(t===e){return 0}return t}function Re(){return m.Core.getStore().getters["chats/get"](this.dialogId)}const qe={DefaultMessage:b.DefaultMessage,FileMessage:v.FileMessage,SmileMessage:C.SmileMessage,CallInviteMessage:I.CallInviteMessage,DeletedMessage:B.DeletedMessage,SystemMessage:f.SystemMessage,UnsupportedMessage:y.UnsupportedMessage,ChatCreationMessage:L.ChatCreationMessage,OwnChatCreationMessage:G.OwnChatCreationMessage,ChatCopilotCreationMessage:_.ChatCopilotCreationMessage,CopilotMessage:S.CopilotMessage,SupportVoteMessage:A.SupportVoteMessage,SupportSessionNumberMessage:E.SupportSessionNumberMessage,SupportChatCreationMessage:F.SupportChatCreationMessage,ConferenceCreationMessage:x.ConferenceCreationMessage,ZoomInviteMessage:w.ZoomInviteMessage,CheckInMessage:D.CheckInMessage,SupervisorUpdateFeatureMessage:T.SupervisorUpdateFeatureMessage,SupervisorEnableFeatureMessage:k.SupervisorEnableFeatureMessage,ChatCopilotAddedUsersMessage:P.ChatCopilotAddedUsersMessage,SignMessage:H.SignMessage,GeneralChatCreationMessage:X.GeneralChatCreationMessage,GeneralChannelCreationMessage:O.GeneralChannelCreationMessage,ChannelCreationMessage:N.ChannelCreationMessage,CallMessage:$.CallMessage,StartDialogMessage:U.StartDialogMessage,FeedbackFormMessage:j.FeedbackFormMessage,HiddenMessage:K.HiddenMessage,VoteMessage:R.VoteMessage};const Ve={name:"MessageList",directives:{"message-observer":{mounted(e,t){t.instance.observer.observeMessage(e)},beforeUnmount(e,t){t.instance.observer.unobserveMessage(e)}}},components:{DateGroup:le,AuthorGroup:ce,NewMessagesBlock:ue,MarkedMessagesBlock:pe,DialogStatus:n.DialogStatus,DialogLoader:q,EmptyState:he,FadeAnimation:a.FadeAnimation,HistoryLimitBanner:Me,...qe},props:{dialogId:{type:String,required:true}},data(){return{windowFocused:false}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},user(){return this.$store.getters["users/get"](this.dialogId,true)},messageCollection(){return this.$store.getters["messages/getByChatId"](this.dialog.chatId)},isUser(){return this.dialog.type===h.ChatType.user},dialogInited(){return this.dialog.inited},formattedCollection(){if(!this.dialogInited&&this.messageCollection.length===0){return[]}return this.getCollectionManager().formatMessageCollection(this.messageCollection)},noMessages(){return this.formattedCollection.length===0},isHistoryLimitExceeded(){return!p.FeatureManager.chatHistory.isAvailable()&&this.dialog.tariffRestrictions.isHistoryLimitExceeded},showDialogStatus(){return this.messageCollection.some((e=>e.id===this.dialog.lastMessageId))},showEmptyState(){return this.dialogInited&&this.noMessages&&this.isUser&&!this.isHistoryLimitExceeded}},created(){this.initCollectionManager();this.initObserverManager()},mounted(){this.subscribeToEvents()},beforeUnmount(){this.unsubscribeFromEvents()},methods:{subscribeToEvents(){c.EventEmitter.subscribe(h.EventType.dialog.onClickMessageContextMenu,this.onMessageContextMenuClick)},unsubscribeFromEvents(){c.EventEmitter.unsubscribe(h.EventType.dialog.onClickMessageContextMenu,this.onMessageContextMenuClick)},insertTextQuote(e){c.EventEmitter.emit(h.EventType.textarea.insertText,{text:s.Quote.prepareQuoteText(e),withNewLine:true,replace:false,dialogId:this.dialogId})},insertMention(e){c.EventEmitter.emit(h.EventType.textarea.insertMention,{mentionText:e.name,mentionReplacement:t.Utils.text.getMentionBbCode(e.id,e.name),dialogId:this.dialogId})},openReplyPanel(e){c.EventEmitter.emit(h.EventType.textarea.replyMessage,{messageId:e,dialogId:this.dialogId})},onAvatarClick(e){const{dialogId:s,$event:a}=e;const i=this.$store.getters["users/get"](s);if(t.Utils.key.isAltOrOption(a)){this.insertMention(i);return}const o=new V;o.openMenu({user:i,dialog:this.dialog},a.currentTarget)},onMessageContextMenuClick(e){const{message:s,event:a,dialogId:i}=e.getData();if(i!==this.dialogId){return}const r=g.PermissionManager.getInstance();if(!r.canPerformActionByRole(h.ActionByRole.openMessageMenu,this.dialogId)){return}if(t.Utils.key.isCombination(a,["Alt+Ctrl"])){this.insertTextQuote(s);return}if(t.Utils.key.isCmdOrCtrl(a)){this.openReplyPanel(s.id);return}const n={dialogId:this.dialogId,...s};const l=o.MessageMenuManager.getInstance();l.openMenu(n,a.currentTarget)},async onMessageMouseUp(e,s){await t.Utils.browser.waitForSelectionToUpdate();const a=window.getSelection().toString().trim();if(a.length===0){return}c.EventEmitter.emit(h.EventType.dialog.showQuoteButton,{message:e,event:s})},initObserverManager(){this.observer=new te(this.dialogId)},getMessageComponentName(e){return new i.MessageComponentManager(e).getName()},initCollectionManager(){this.collectionManager=new Ue(this.dialogId)},getCollectionManager(){return this.collectionManager}},template:`\n\t\t<slot v-if="!dialogInited" name="loader">\n\t\t\t<DialogLoader />\n\t\t</slot>\n\t\t<FadeAnimation :duration="200">\n\t\t\t<div v-if="dialogInited" class="bx-im-message-list__container">\n\t\t\t\t<EmptyState v-if="showEmptyState" :dialogId="dialogId" />\n\t\t\t\t<slot name="before-messages" :getMessageComponentName="getMessageComponentName"></slot>\n\t\t\t\t<HistoryLimitBanner v-if="isHistoryLimitExceeded" :dialogId="dialogId" :noMessages="noMessages" />\n\t\t\t\t<DateGroup v-for="dateGroup in formattedCollection" :key="dateGroup.dateTitle" :item="dateGroup">\n\t\t\t\t\t\x3c!-- Slot for every date group item --\x3e\n\t\t\t\t\t<template #dateGroupItem="{ dateGroupItem, isMarkedBlock, isNewMessagesBlock, isAuthorBlock }">\n\t\t\t\t\t\t<MarkedMessagesBlock v-if="isMarkedBlock" data-id="newMessages" />\n\t\t\t\t\t\t<NewMessagesBlock v-else-if="isNewMessagesBlock" data-id="newMessages" />\n\t\t\t\t\t\t<AuthorGroup \n\t\t\t\t\t\t\tv-else-if="isAuthorBlock" \n\t\t\t\t\t\t\t:item="dateGroupItem"\n\t\t\t\t\t\t\t:contextDialogId="dialogId"\n\t\t\t\t\t\t\t@avatarClick="onAvatarClick"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\x3c!-- Slot for every message --\x3e\n\t\t\t\t\t\t\t<template #message="{ message, index }">\n\t\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t\tv-message-observer\n\t\t\t\t\t\t\t\t\t:is="getMessageComponentName(message)"\n\t\t\t\t\t\t\t\t\t:withTitle="index === 0"\n\t\t\t\t\t\t\t\t\t:item="message"\n\t\t\t\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t\t\t\t:key="message.id"\n\t\t\t\t\t\t\t\t\t:data-viewed="message.viewed"\n\t\t\t\t\t\t\t\t\t@mouseup="onMessageMouseUp(message, $event)"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</component>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</AuthorGroup>\n\t\t\t\t\t</template>\n\t\t\t\t</DateGroup>\n\t\t\t\t<DialogStatus v-if="showDialogStatus" :dialogId="dialogId" />\n\t\t\t</div>\n\t\t</FadeAnimation>\n\t`};e.MessageList=Ve;e.AvatarMenu=V;e.AuthorGroup=ce;e.MessageComponents=qe;e.CollectionManager=Ue})(this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Component?.Animation??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Lib??{},BX??{},BX?.Messenger?.v2?.Component?.Elements??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Lib??{},BX??{},BX?.Event??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Application??{},BX?.Messenger?.v2?.Const??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.OpenLines?.v2?.Component?.Message??{},BX?.OpenLines?.v2?.Component?.Message??{},BX?.OpenLines?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{},BX?.Messenger?.v2?.Component?.Message??{});
//# sourceMappingURL=message-list.bundle.map.js